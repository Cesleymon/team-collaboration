import random

def blackjack():
    def create_deck():
        suits = ['Hearts', 'Diamonds', 'Clubs', 'Spades']
        cards = ['1','2','3','4','5','6','7','8','9','10','J','Q','K','A']
        deck = [(suit, card) for suit in suits for card in cards] #This gives cards in the deck both a number and suit 
        random.shuffle(deck) #This is to ensure all players recieve random cards
        return deck

    def deal_one_card(deck):
        return deck.pop() # This deals cards to the player and dealer

    def calculate_score(hand):
        values = []
        for card in hand: #Goes through each card in the player/dealers hand
            rank = card[1] 
            if rank in ['J','Q','K']:
                values.append(10) # This assigns J,Q, and K values of 10
            elif rank == 'A':
                values.append(11) #Adds 11 to the total values 
            else:
                values.append(int(rank))
        score = sum(values)
        while score > 21 and 11 in values: #This while loop is there to determine whether the ace is played as a 11 or 1
            ace_index = values.index(11)
            values[ace_index] = 1
            score = sum(values) #This finishes the steps by tallying up all the card values 
        return score

    def add_card(player_hand, deck, choice):
        if choice == 'yes': #This is what happens if the players decides to get a hit
            player_hand.append(deal_one_card(deck)) #Calls the function deal_one_card to add a random card
            print('You got:', card)
            player_score = calculate_score(player_hand)
            if player_score > 21:
                return 'bust', player_hand
            else:
                return 'continue', player_hand
        elif choice == 'no': #This is what happens if the player decides to stand 
            return 'stand', player_hand
        else: #The else function is there incase the player inputs something other than yes or no
            return 'invalid', player_hand

    def player_turn(player_hand, deck):
        while True:
            score = calculate_score(player_hand)
            if score > 21:
                return "Bust"
            if score == 21:
                return "Winner"

            choice = input("Do you want another card? (yes/no): ").lower()
            status, player_hand = add_card(player_hand, deck, choice)
            if status == 'bust':
                return "Bust"
            elif status == 'stand':
                return "Final score: " + str(calculate_score(player_hand))
            elif status == 'invalid':
                print("Please type 'yes' or 'no'.")

    def dealer_turn(deck, dealer_hand):
        while True:
            score = calculate_score(dealer_hand)
            if score < 17:
                card = deal_one_card(deck)
                dealer_hand.append(card)
                print('Dealer hits and gets', card)
            else:
                print('Dealer stands with score', score)
                break

    def determine_winner(player_hand, dealer_hand):
        player_score = calculate_score(player_hand)
        dealer_score = calculate_score(dealer_hand)

        if player_score > 21:
            return "DEALER WINS ðŸŽ‰ðŸŽ‰ðŸŽ‰ !!!"
        elif dealer_score > 21:
            return "PLAYER WINS ðŸŽ‰ðŸŽ‰ðŸŽ‰!!!"
        elif player_score > dealer_score:
            return "PLAYER WINS ðŸŽ‰ðŸŽ‰ðŸŽ‰!!!"
        elif dealer_score > player_score:
            return "DEALER WINS ðŸŽ‰ðŸŽ‰ðŸŽ‰!!!"
        else:
            return "It's a tie!"

    # Game start
    deck = create_deck()
    player_hand = [deal_one_card(deck), deal_one_card(deck)]
    dealer_hand = [deal_one_card(deck), deal_one_card(deck)]

    print("YOUR HAND:", player_hand)
    print("DEALER'S VISIBLE CARD:", dealer_hand[0])

    player_result = player_turn(player_hand, deck)
    print(player_result)

    if player_result != 'Bust':
        dealer_turn(deck, dealer_hand)
        result = determine_winner(player_hand, dealer_hand)
        print(result)


